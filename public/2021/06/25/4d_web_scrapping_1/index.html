<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>4D web scrapping part 1 | PhilYeo.DEV</title>
<meta name="keywords" content="webscraping, project">
<meta name="description" content="As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia&rsquo;s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:
 Damacai Magnum Sports Toto  Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward.">
<meta name="author" content="">
<link rel="canonical" href="/2021/06/25/4d_web_scrapping_1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="mask-icon" href="safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YRXE6MJVJC"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-YRXE6MJVJC', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="4D web scrapping part 1" />
<meta property="og:description" content="As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia&rsquo;s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:
 Damacai Magnum Sports Toto  Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2021/06/25/4d_web_scrapping_1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-25T16:44:25&#43;08:00" />
<meta property="article:modified_time" content="2021-06-25T16:44:25&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="4D web scrapping part 1"/>
<meta name="twitter:description" content="As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia&rsquo;s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:
 Damacai Magnum Sports Toto  Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "4D web scrapping part 1",
      "item": "/2021/06/25/4d_web_scrapping_1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "4D web scrapping part 1",
  "name": "4D web scrapping part 1",
  "description": "As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia\u0026rsquo;s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:\n Damacai Magnum Sports Toto  Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward.",
  "keywords": [
    "webscraping", "project"
  ],
  "articleBody": "As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia’s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:\n Damacai Magnum Sports Toto  Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward. But Damacai’s was a little trickier but can be obtain.\nAs for Sports Toto’s, I had some initial problem finding API. Using DevTools I was not able to find any API get requests anywhere, thus I decided to using some MITM (man-in-the-middle) technique to see if they had their API calls via their android application. Now even having done that, I was not able to find any API request via the wire. This means that the data rendering is clearly done on the server side and the html tables or list was already rendered before sending down the whole html response to the client. Which means that API is definitely not a way to go with Toto’s webiste. I had no choice but to use a scraper / crawler for it.\nWhat scraper to use?\nAt first I was using scrapy which is a python based scarping framework. I liked it because it comes with all the bells and whistle. Once you downloaded the library, it has settings.py, config.py and much more which one can leverage on. Its also neatly and thoughtfully had all these features structured nicely for the user to implement their robot for its crawling or scraping needs. Even has the items for outputing captured data in a nice object notation form. But scrapy was acting weird for me because it seems that when the webpage was ingested into the internal object, some additional tags (\\t, \\n, and \\r) were injected into it thus rendering my xpath calls useless.\nAfter trying countless times, I decided to switch to puppeteer which is Google’s javascript based scraping framework. Love it immediately. Compared to scrapy, there’s less documentation and help/ resources, but that’s quickly going to change. I see lots of people adopting puppeteer and its also extremely powerful and quick. I didn’t have those additional tags being injected mid-stream when running the code, thus my queryselectors and xpaths all just works!!!\nI’ve my initial scraping in my github js4dscrapper repository. And its still a work in progress.\nNext up is to work on my APIs for the other 2 players.\n",
  "wordCount" : "426",
  "inLanguage": "en",
  "datePublished": "2021-06-25T16:44:25+08:00",
  "dateModified": "2021-06-25T16:44:25+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/2021/06/25/4d_web_scrapping_1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PhilYeo.DEV",
    "logo": {
      "@type": "ImageObject",
      "url": "favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="" accesskey="h" title="PhilYeo.DEV (Alt + H)">PhilYeo.DEV</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="/page/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      4D web scrapping part 1
    </h1>
    <div class="post-meta"><span title='2021-06-25 16:44:25 +0800 +08'>June 25, 2021</span>

</div>
  </header> 
  <div class="post-content"><p>As I mentioned earlier, I was embarking on my side project (in efforts to improve my JS knowledge). I want to consolidate all our Malaysia&rsquo;s 4D gaming results into a single hosted app. Thus I needed to find the sources. I know that there are 3 major betting company players:</p>
<ol>
<li>Damacai</li>
<li>Magnum</li>
<li>Sports Toto</li>
</ol>
<p>Of the 3, both Magnum and Damacai has APIs which I can use. Of these 2, Magnum API is pretty straightforward. But Damacai&rsquo;s was a little trickier but can be obtain.</p>
<p>As for Sports Toto&rsquo;s, I had some initial problem finding API. Using DevTools I was not able to find any API get requests anywhere, thus I decided to using some MITM (man-in-the-middle) technique to see if they had their API calls via their android application. Now even having done that, I was not able to find any API request via the wire. This means that the data rendering is clearly done on the server side and the html tables or list was already rendered before sending down the whole html response to the client. Which means that API is definitely not a way to go with Toto&rsquo;s webiste. I had no choice but to use a scraper / crawler for it.</p>
<p>What scraper to use?</p>
<p>At first I was using scrapy which is a python based scarping framework. I liked it because it comes with all the bells and whistle. Once you downloaded the library, it has settings.py, config.py and much more which one can leverage on. Its also neatly and thoughtfully had all these features structured nicely for the user to implement their robot for its crawling or scraping needs. Even has the items for outputing captured data in a nice object notation form. But scrapy was acting weird for me because it seems that when the webpage was ingested into the internal object, some additional tags (\t, \n, and \r) were injected into it thus rendering my xpath calls useless.</p>
<p>After trying countless times, I decided to switch to puppeteer which is Google&rsquo;s javascript based scraping framework. Love it immediately. Compared to scrapy, there&rsquo;s less documentation and help/ resources, but that&rsquo;s quickly going to change. I see lots of people adopting puppeteer and its also extremely powerful and quick. I didn&rsquo;t have those additional tags being injected mid-stream when running the code, thus my queryselectors and xpaths all just works!!!</p>
<p>I&rsquo;ve my initial scraping in my github js4dscrapper repository. And its still a work in progress.</p>
<p>Next up is to work on my APIs for the other 2 players.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/webscraping/">webscraping</a></li>
      <li><a href="/tags/project/">project</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>Philip Yeo</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
